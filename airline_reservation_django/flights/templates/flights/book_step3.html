{% extends 'flights/base.html' %}
{% load static %}

{% block content %}

<link rel="stylesheet" href="{% static 'flights/flight_step3.css' %}">
<script src="{% static 'flights/flight_step3.js' %}"></script>

<h1>Step 3: Select Your Seats</h1>

{% if return_flight and flight.id != departure_id %}
    <h2 class="flight-type return">Selecting seats for RETURN flight</h2>
{% else %}
    <h2 class="flight-type departure">Selecting seats for DEPARTURE flight</h2>
{% endif %}

<p><strong>{{ flight.departure_city }} → {{ flight.arrival_city }}</strong></p>
<p>{{ flight.date }} | {{ flight.price }} €</p>

{% if return_flight %}
    <hr>
    <h3>Your Return Flight</h3>
    <p><strong>{{ return_flight.departure_city }} → {{ return_flight.arrival_city }}</strong></p>
    <p>{{ return_flight.date }} | {{ return_flight.price }} €</p>
    <hr>
{% endif %}

<p>You need to select {{ num_passengers }} seat{{ num_passengers|pluralize:"s" }} for this flight.</p>
<p>Selected: {{ selected_seats|length }} / {{ num_passengers }}</p>

<form method="post">
    {% csrf_token %}

    <div class="seat-map-container">
        {% for row in seat_positions %}
            <div class="row">
                <div class="left-side">
                    {% for seat in row.left %}
                        <div 
                            class="seat 
                                {% if seat.occupied %}occupied
                                {% elif seat.seat_id|stringformat:'s' in selected_seats %}selected{% endif %}"
                            id="seat-{{ seat.seat_id }}"
                            data-seat="{{ seat.seat_id }}"
                            data-top="{{ seat.top }}"
                            data-left="{{ seat.left }}">
                            {{ seat.seat_id }}
                        </div>
                    {% endfor %}
                </div>

                <div class="right-side">
                    {% for seat in row.right %}
                        <div
                            class="seat 
                                {% if seat.occupied %}occupied
                                {% elif seat.seat_id|stringformat:'s' in selected_seats %}selected{% endif %}"
                            id="seat-{{ seat.seat_id }}"
                            data-seat="{{ seat.seat_id }}"
                            data-top="{{ seat.top }}"
                            data-left="{{ seat.left }}">
                            {{ seat.seat_id }}
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </div>

    <input type="hidden" name="selected_seat" id="selected_seat_input">

    {% if selected_seats|length >= num_passengers %}
        <button type="submit" class="continue-btn">Continue →</button>
    {% endif %}
</form>

{% endblock %}
