{% extends 'flights/base.html' %}
{% load static %}

{% block content %}
<h1>Search Flights</h1>

<link rel="stylesheet" href="{% static 'flights/search.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<div id="search-box">
  <label>Origin country:</label>
  <select id="origin_country">
    <option value="">-- Select country --</option>
  </select>

  <label>Pick an airport:</label>
  <select id="origin_airport" disabled>
    <option value="">-- Select airport --</option>
  </select>

  <label>Destination country:</label>
  <select id="dest_country" disabled>
    <option value="">-- Select country --</option>
  </select>

  <label>Pick an airport:</label>
  <select id="dest_airport" disabled>
    <option value="">-- Select airport --</option>
  </select>

  <label>Trip type:</label>
  <select id="trip_type">
    <option value="oneway" selected>One way</option>
    <option value="round">Round trip</option>
  </select>

  <label>Departure date:</label>
  <input type="text" id="departure_date" placeholder="Select departure date">

  <label id="return_label" style="display:none;">Return date:</label>
  <input type="text" id="return_date" placeholder="Select return date" style="display:none;">

  <button id="searchBtn">Search flights</button>
</div>

<hr>

{% if show_results %}
  {% if flights %}
    <form id="selectFlightsForm" onsubmit="return handleFlightSelection(event)">
      <h2>Available Flights</h2>
      <table>
        <tr>
          <th>Select</th>
          <th>From → To</th>
          <th>Date</th>
          <th>Price</th>
        </tr>
        {% for flight in flights %}
        <tr>
          <td><input type="radio" name="departure_flight" value="{{ flight.id }}"></td>
          <td>{{ flight.departure_city }} → {{ flight.arrival_city }}</td>
          <td>{{ flight.date }}</td>
          <td>${{ flight.price }}</td>
        </tr>
        {% endfor %}
      </table>

      {% if return_flights %}
      <h2>Return Flights</h2>
      <table>
        <tr>
          <th>Select</th>
          <th>From → To</th>
          <th>Date</th>
          <th>Price</th>
        </tr>
        {% for flight in return_flights %}
        <tr>
          <td><input type="radio" name="return_flight" value="{{ flight.id }}"></td>
          <td>{{ flight.departure_city }} → {{ flight.arrival_city }}</td>
          <td>{{ flight.date }}</td>
          <td>${{ flight.price }}</td>
        </tr>
        {% endfor %}
      </table>
      {% endif %}

      <label>Number of passengers:</label>
      <input type="number" id="num_passengers" min="1" max="9" value="1">

      <br><br>
      <button type="submit">Continue →</button>
    </form>
  {% else %}
    <p>No flights found for selected route and date.</p>
  {% endif %}
{% endif %}

{% if user.is_staff %}
  <a href="{% url 'create_flight' %}">Create New Flight</a>
{% endif %}

{% if user.is_authenticated %}
  <a href="{% url 'logout' %}">Logout</a>
{% else %}
  <a href="{% url 'login' %}">Login</a> |
  <a href="{% url 'register' %}">Register</a>
{% endif %}

<script src="{% static 'flights/search.js' %}"></script>
{% endblock %}
